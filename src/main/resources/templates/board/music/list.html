<!-- board/music/list.html -->
<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/fragments/base}">

<body>
<div layout:fragment="content">
    <main class="board-container board board-music"
          th:attr="data-login=${loginUserId != null}">

        <div th:if="${adminMemberDisplayName != null and !#strings.isEmpty(#strings.trim(adminMemberDisplayName))}"
             style="margin-bottom:12px; text-align:center; color:#555;">
            <strong th:text="${adminMemberDisplayName}">닉네임</strong>님의 게시글목록
        </div>

        <!-- 상단: 검색 + 글쓰기 버튼 한 줄 -->
        <div class="board-list-top">

            <!-- 검색 폼 -->
            <form action="/music/search/page/1" method="GET" class="board-search-form">
                <input name="q"
                       class="board-search-input"
                       th:value="${query}"
                       placeholder="검색어를 입력하세요">

                <button type="submit" class="btn-search">검색</button>

                <!-- 검색상태면 전체보기 버튼 -->
                <a th:if="${searchMode}"
                   href="/music/list/page/1"
                   class="board-reset-link">전체 보기</a>
            </form>

            <div class="board-list-actions">
                <!-- 글쓰기 버튼 : 누구에게나 보이지만, 비로그인은 모달 -->
                <a href="/music/write"
                   class="btn-search board-action-btn js-login-required-link"
                   data-login-message="글쓰기는 로그인 후 이용 가능합니다.\n로그인 페이지로 이동합니다.">
                    🖋 글쓰기
                </a>

                <!-- 내가 쓴 글 / 전체 글 토글 -->
                <a th:if="${!#bools.isTrue(myMode)}"
                   th:href="@{|/music/my/page/1|}"
                   class="btn-search board-action-btn js-login-required-link"
                   data-login-message="내가 쓴 글 보기는 로그인 후 이용 가능합니다.\n로그인 페이지로 이동합니다.">
                    내가 쓴 글
                </a>
                <a th:if="${#bools.isTrue(myMode)}"
                   th:href="@{|/music/list/page/1|}"
                   class="btn-search board-action-btn">
                    전체 글
                </a>
            </div>
        </div>

        <!-- 게시판 제목 -->
        <h2 class="board-title">노래</h2>

        <!-- 테이블형 리스트 -->
        <section class="board-table-wrapper">
            <table class="board-table">
                <thead>
                <tr>
                    <th class="col-title">글제목</th>
                    <th class="col-writer">작성자</th>
                    <th class="col-date">작성시간</th>
                </tr>
                </thead>
                <tbody>

                <!-- 글이 없을 때 -->
                <tr th:if="${#lists.isEmpty(items)}">
                    <td colspan="3">작성된 게시글이 없습니다.</td>
                </tr>

                <!-- 글 목록 -->
                <tr th:each="post : ${items}">
                    <td class="col-title">
                        <a class="board-link"
                           th:href="@{|/music/detail/${post.id}|}"
                           th:text="${post.title}">제목</a>

                        <!-- 댓글수 · 조회수 · 추천수 -->
                        <span class="board-meta">
                            <span class="board-comment-count">
                                [
                                <span th:text="${(commentCounts != null and commentCounts[post.id] != null) ? commentCounts[post.id] : 0}">0</span>
                                ]
                            </span>
                            · 조회
                            <span th:text="${post.viewCount}">0</span>
                            · 추천
                            <span th:text="${post.recommendCount}">0</span>
                        </span>
                    </td>

                    <!-- 작성자 칼럼 -->
                    <td class="col-writer"
                        th:text="${post.writer.displayName}">
                        작성자
                    </td>

                    <td class="col-date"
                        th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">
                        2025-01-01 12:00
                    </td>
                </tr>

                </tbody>
            </table>
        </section>

        <!-- 페이지네이션 -->
        <nav class="pagination"
             th:if="${!#bools.isTrue(searchMode)}">

            <span th:if="${current > 1}">
                <!-- myMode 에 따라 URL 분기 -->
                <a th:href="${#bools.isTrue(myMode)} ? @{|/music/my/page/1|} : @{|/music/list/page/1|}">첫페이지</a>
                <a th:href="${#bools.isTrue(myMode)} ? @{|/music/my/page/${current-1}|} : @{|/music/list/page/${current-1}|}">이전</a>
            </span>

            <span th:each="p : ${#numbers.sequence(startPage, endPage)}">
                <a th:if="${p != current}"
                   th:href="${#bools.isTrue(myMode)} ? @{|/music/my/page/${p}|} : @{|/music/list/page/${p}|}"
                   th:text="${p}"></a>

                <strong th:if="${p == current}"
                        th:text="${p}"></strong>
            </span>

            <span th:if="${current < totalPages}">
                <a th:href="${#bools.isTrue(myMode)} ? @{|/music/my/page/${current+1}|} : @{|/music/list/page/${current+1}|}">다음</a>
                <a th:href="${#bools.isTrue(myMode)} ? @{|/music/my/page/${totalPages}|} : @{|/music/list/page/${totalPages}|}">마지막페이지</a>
            </span>

        </nav>

        <!-- 검색 모드 페이지네이션 -->
        <nav class="pagination"
             th:if="${#bools.isTrue(searchMode)}">

            <span th:if="${current > 1}">
                <a th:href="@{|/music/search/page/1?q=${query}|}">첫페이지</a>
                <a th:href="@{|/music/search/page/${current-1}?q=${query}|}">이전</a>
            </span>

            <span th:each="p : ${#numbers.sequence(startPage, endPage)}">
                <a th:if="${p != current}"
                   th:href="@{|/music/search/page/${p}?q=${query}|}"
                   th:text="${p}"></a>

                <strong th:if="${p == current}"
                        th:text="${p}"></strong>
            </span>

            <span th:if="${current < totalPages}">
                <a th:href="@{|/music/search/page/${current+1}?q=${query}|}">다음</a>
                <a th:href="@{|/music/search/page/${totalPages}?q=${query}|}">마지막페이지</a>
            </span>

        </nav>

    </main>
</div>
</body>
</html>
