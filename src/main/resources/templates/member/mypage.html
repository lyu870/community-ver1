<!-- member/mypage.html -->
<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/fragments/base}">
<head>
    <title th:with="title='마이페이지'">마이페이지</title>
</head>
<body>
<div layout:fragment="content">
    <main class="board-container">

        <section class="auth-card-wrap">
            <div class="auth-card-body">

                <h2 style="font-size:1.3rem; margin-bottom:16px;">마이페이지</h2>

                <!-- 프로필 정보 영역 -->
                <section style="margin-top:4px;">
                    <h3 style="font-size:1rem; margin-bottom:8px;">프로필 정보</h3>

                    <p style="margin-bottom:4px;">아이디 :
                        <strong th:text="${member.username}">username</strong>
                    </p>

                    <p>닉네임 :
                        <strong id="currentNickname" th:text="${member.displayName}">displayName</strong>
                    </p>

                    <!-- 액션 버튼 영역 -->
                    <div class="flex-row gap-8 mt-12">
                        <button type="button"
                                id="openProfileBtn"
                                class="auth-btn-secondary"
                                style="flex:1;">
                            닉네임 변경
                        </button>
                        <button type="button"
                                id="openPasswordBtn"
                                class="auth-btn-secondary"
                                style="flex:1;">
                            비밀번호 변경
                        </button>
                    </div>
                </section>

                <!-- 닉네임 변경 영역 -->
                <section id="profileSection" style="margin-top:24px; display:none;">
                    <h3 style="font-size:1rem; margin-bottom:8px;">닉네임 변경</h3>

                    <!-- 닉네임변경 결과메시지 -->
                    <div id="profileMessageBox">
                        <div id="profileMessage" class="msg ok" style="display:none;"></div>
                        <div id="profileError" class="msg err" style="display:none;"></div>
                    </div>

                    <!-- 닉네임 변경 폼 -->
                    <form id="profileForm"
                          th:action="@{/my-page/profile}"
                          method="post"
                          style="margin-top:10px;">
                        <label class="auth-label">
                            새 닉네임
                        </label>
                        <input type="text"
                               name="newDisplayName"
                               placeholder="새 닉네임"
                               required
                               class="auth-input">
                        <div class="flex-row gap-8 mt-8">
                            <button type="submit"
                                    class="auth-btn-primary"
                                    style="flex:1;">
                                변경하기
                            </button>
                            <button type="button"
                                    id="cancelProfileBtn"
                                    class="auth-btn-secondary"
                                    style="flex:1;">
                                취소
                            </button>
                        </div>
                    </form>
                </section>

                <!-- 비밀번호 변경영역 -->
                <section id="passwordSection" style="margin-top:24px; display:none;">
                    <h3 style="font-size:1rem; margin-bottom:8px;">비밀번호 변경</h3>

                    <!-- 비밀번호 변경결과 메시지 -->
                    <div id="passwordMessageBox">
                        <div id="passwordMessage" class="msg ok" style="display:none;"></div>
                        <div id="passwordError" class="msg err" style="display:none;"></div>
                    </div>

                    <form id="passwordForm"
                          th:action="@{/my-page/password}"
                          method="post"
                          style="display:flex; flex-direction:column; gap:8px; max-width:none; margin-top:10px;">

                        <label class="auth-label">
                            현재 비밀번호
                        </label>
                        <input type="password"
                               name="currentPassword"
                               required
                               class="auth-input">

                        <label class="auth-label" style="margin-top:4px;">
                            새 비밀번호
                        </label>
                        <input type="password"
                               name="newPassword"
                               required
                               class="auth-input">

                        <label class="auth-label" style="margin-top:4px;">
                            새 비밀번호 확인
                        </label>
                        <input type="password"
                               name="newPasswordConfirm"
                               required
                               class="auth-input">

                        <!-- 비밀번호 일치 메시지 영역 (실시간) -->
                        <div id="passwordMatchMsg" class="text-sm mt-4"></div>

                        <small class="text-xs mt-2">비밀번호는 영문 + 숫자 조합 8자 이상이어야 합니다.</small>

                        <div class="flex-row gap-8 mt-8">
                            <button type="submit"
                                    class="auth-btn-primary"
                                    style="flex:1;">
                                변경하기
                            </button>
                            <button type="button"
                                    id="cancelPasswordBtn"
                                    class="auth-btn-secondary"
                                    style="flex:1;">
                                취소
                            </button>
                        </div>
                    </form>
                </section>

                <!-- 회원 탈퇴 영역 -->
                <section id="withdrawSection" style="margin-top:24px;">
                    <h3 style="font-size:1rem; margin-bottom:8px;">회원 탈퇴</h3>
                    <p class="text-sm" style="color:#555; line-height:1.5;">
                        회원탈퇴 시 회원님이 작성한 게시글과 댓글, 회원 정보가 모두 삭제되며<br>
                        삭제된 데이터는 되돌릴 수 없습니다.
                    </p>

                    <div class="mt-8">
                        <a href="/my-page/withdraw"
                           style="display:inline-block; width:100%; text-align:center; padding:8px 0;
                                  color:#fff; background:#d93025; border:1px solid #d93025; text-decoration:none; font-size:0.9rem;">
                            회원탈퇴
                        </a>
                    </div>
                </section>

            </div>
        </section>

        <script th:src="@{/js/mypage.js}"></script>

    </main>
</div>
</body>
</html>
